<app-header></app-header>
<div
      class="card"
      mwlDroppable
      (drop)="externalDrop($event.dropData.event)"
      dragOverClass="drag-over"
    >
    <div class="card-body">
      <p *ngIf="externalEvents.length === 0"><em>No events added</em></p>
      <ul>
        <li
          *ngFor="let event of externalEvents"
          mwlDraggable
          [dropData]="{event: event}"
          [touchStartLongPress]="{ delay: 300, delta: 30 }"
          dragActiveClass="drag-active"
        >
          <a href="javascript:;" >
            {{ event.title }}
          </a>
        </li>
      </ul>
    </div>
  </div>
  
  
<div id="calendar-container" class="row text-center">
  <div class="col-md-4">
    <!-- Navigation buttons -->
    <div class="btn-group">
      <!-- Previous button -->
      <div class="btn btn-primary"
           mwlCalendarPreviousView
           [view]="view"
           [(viewDate)]="viewDate"
           (viewDateChange)="closeOpenMonthViewDay()">Previous</div>
      <!-- Today button -->
      <div class="btn btn-outline-secondary"
           mwlCalendarToday
           [(viewDate)]="viewDate">Today</div>
      <!-- Next button -->
      <div class="btn btn-primary"
           mwlCalendarNextView
           [view]="view"
           [(viewDate)]="viewDate"
           (viewDateChange)="closeOpenMonthViewDay()">Next</div>
    </div>
  </div> 

  <div class="col-md-4">
    <!-- View date -->
    <h3>{{ viewDate | calendarDate:(view + 'ViewTitle'):'en' }}</h3>
  </div>
  <div class="col-md-4">
    <!-- View buttons -->
    <div class="btn-group">
      <!-- Month view button -->
      <div class="btn btn-primary"
           (click)="setView(CalendarView.Month)"
           [class.active]="view === CalendarView.Month">Month</div>
      <!-- Week view button -->
      <div class="btn btn-primary"
           (click)="setView(CalendarView.Week)"
           [class.active]="view === CalendarView.Week">Week</div>
      <!-- Day view button -->
      <div class="btn btn-primary"
           (click)="setView(CalendarView.Day)"
           [class.active]="view === CalendarView.Day">Day</div>
    </div>
  </div>
</div>

<br />

<!-- Calendar view based on selected view -->
<!-- Calendar view based on selected view -->
<div [ngSwitch]="view">
  <!-- Month view -->
<!-- Calendar view based on selected view -->
<div [ngSwitch]="view">
  <!-- Month view -->
  <mwl-calendar-month-view *ngSwitchCase="CalendarView.Month"
                            [viewDate]="viewDate"
                            [events]="events"
                            [refresh]="refresh"
                            [activeDayIsOpen]="activeDayIsOpen"
                            (dayClicked)="dayClicked($event.day)"
                            (eventClicked)="handleEvent('Clicked', $event.event)"
                            (eventTimesChanged)="eventTimesChanged($event)">
                              > <!-- Pass object with date property -->
  </mwl-calendar-month-view>
  
  <!-- Week view -->
  <mwl-calendar-week-view *ngSwitchCase="CalendarView.Week"
                           [viewDate]="viewDate"           
                           [events]="events"
                           [refresh]="refresh"
                           (eventClicked)="handleEvent('Clicked', $event.event)"
                           (eventTimesChanged)="eventTimesChanged($event)"
                           (dayHeaderClicked)="clickedDate = $event.day.date"
                           (hourSegmentClicked)="clickedDate = $event.date; openAddEventDialog($event.date)"> <!-- Removed comment -->
  </mwl-calendar-week-view>
  
  <!-- Day view -->
  <mwl-calendar-day-view *ngSwitchCase="CalendarView.Day"
                          [viewDate]="viewDate"
                          [events]="events"
                          [refresh]="refresh"
                          (eventClicked)="handleEvent('Clicked', $event.event)"
                          (eventTimesChanged)="eventTimesChanged($event)"
                          (hourSegmentClicked)="clickedDate = $event.date;openAddEventDialog($event.date)"> <!-- Removed comment -->
  </mwl-calendar-day-view>
</div>
</div>

<!-- Demo-only content -->
<br /><br /><br />

<!-- Edit events section -->


<!-- Table to display events -->
<div class="clearfix"></div> 



<!-- Modal template -->
<!-- Inside your calendar component template -->
<!-- Inside your calendar component template -->
<!-- Modal template -->
<ng-template #modalContent let-close="close">  
  
  
  <div class="modal-header">
    <h5 class="modal-title">Edit Event</h5>
    <button type="button" class="close" (click)="close()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <!-- Display event details for editing if modalData and modalData.event are defined -->
    <div *ngIf="modalData && modalData.event">
      <div class="form-group">
        <label for="title">Title:</label>
        <input id="title" type="text" class="form-control" [(ngModel)]="modalData.event.title" [disabled]="!isEditable(modalData.event)">
      </div>
      <div class="form-group" *ngIf="offererOrRequester(modalData.event) === 0">
        <label for="requester">Requester:</label>
        <input id="requester" type="text" class="form-control" [(ngModel)]="modalData.event.requester" [disabled]="!isEditable(modalData.event)">
      </div>
      <div class="form-group" *ngIf="offererOrRequester(modalData.event) === 1">
        <label for="offerer">Offerer:</label>
        <input id="offerer" type="text" class="form-control" [(ngModel)]="modalData.event.offerer" [disabled]="!isEditable(modalData.event)">
      </div> 
      <div class="form-group" *ngIf="offererOrRequester(modalData.event) === -1"> 
        <label for="requester">Requester:</label>
        <input id="requester" type="text" class="form-control" [(ngModel)]="modalData.event.requester" [disabled]="!isEditable(modalData.event)">
        <label for="offerer">Offerer:</label>
        <input id="offerer" type="text" class="form-control" [(ngModel)]="modalData.event.offerer" [disabled]="!isEditable(modalData.event)">
      </div> 

      <div class="form-group">
        <label for="start">Start Date:</label>
        <!-- Input for start date using Flatpickr -->
        <input
          id="start"
          type="text"
          class="form-control"
          [(ngModel)]="modalData.event.start"
          mwlFlatpickr
          [altInput]="true"
          [enableTime]="true"
          dateFormat="Y-m-dTH:i"
          altFormat="F j, Y H:i"
          placeholder="Not set"
          [disabled]="!isEditable(modalData.event)"
          (change)="refresh.next()"
        >
      </div>
      <div class="form-group">
        <label for="end">End Date:</label>
        <!-- Input for end date using Flatpickr -->
        <input
          id="end"
          type="text"
          class="form-control"
          [(ngModel)]="modalData.event.end"
          mwlFlatpickr
          [altInput]="true"
          [enableTime]="true"
          dateFormat="Y-m-dTH:i"
          altFormat="F j, Y H:i" 
          placeholder="Not set"
          [disabled]="!isEditable(modalData.event)"
          (change)="refresh.next()"
        >
      </div>  
      
    </div> 
  </div>   
  <ng-container *ngIf="modalData?.event?.fixedRequester && modalData?.event?.fixedOfferer && modalData?.event?.acceptRenter!=null&&modalData?.event?.acceptRenting!=null">
    <span class="confirmation-text">Confirmed</span>
  </ng-container> 
  <ng-container *ngIf="modalData?.event?.fixedRequester == null && modalData?.event?.fixedOfferer && modalData?.event?.fixedOfferer && offererOrRequester(modalData!.event) == 1">
    <span class="confirmation-text pending-text">waiting for your Confirmation </span>
  </ng-container>   

  <ng-container *ngIf="modalData?.event?.fixedRequester == null && modalData?.event?.fixedOfferer && modalData?.event?.fixedOfferer && offererOrRequester(modalData!.event) == 0">
    <span class="confirmation-text pending-text">waiting for {{modalData?.event?.requester}} Confirmation </span>
  </ng-container>   

  
  <ng-container *ngIf="modalData?.event?.acceptRenter == null && modalData?.event?.acceptRenting && offererOrRequester(modalData!.event) == 0">
    <span class="confirmation-text pending-text">Waiting for your Confirmation  </span>
      </ng-container>  
  <ng-container *ngIf="modalData?.event?.acceptRenter == null && modalData?.event?.acceptRenting && offererOrRequester(modalData!.event) == 1">
    <span class="confirmation-text pending-text">waiting for confirmation from : {{modalData!.event.requester}}</span>
  </ng-container> 

  <ng-container *ngIf="modalData?.event?.acceptRenting == null && modalData?.event?.acceptRenter  ">
    <span class="confirmation-text pending-text">waiting for Confirmation From {{ modalData!.event.requester }}</span>
  </ng-container>




  <ng-container *ngIf="modalData?.event?.fixedRequester == false && modalData?.event?.fixedOfferer">
    <span class="confirmation-text refused-text">Refused</span>
  </ng-container>
  <div class="modal-footer"> 
    <!-- Show specific buttons when the condition is met -->
    <ng-container *ngIf="offererOrRequester(modalData!.event) == 0 && isCurrentDateSuperior(modalData!.event) && modalData?.event?.fixedRequester && modalData?.event?.fixedOfferer"> 
    <button type="button" class="btn btn-primary" (click)="acceptRenter(modalData!.event)" [disabled]="modalData!.event.acceptRenter!=null">Accept Renter</button> 
    <button type="button" class="btn btn-primary" (click)="refuseRenter(modalData!.event)" [disabled]="modalData!.event.acceptRenter!=null">Refuse Renter</button>

    </ng-container>  

    <ng-container *ngIf="offererOrRequester(modalData!.event) == 1 && isCurrentDateSuperior(modalData!.event) && modalData?.event?.fixedRequester && modalData?.event?.fixedOfferer"> 

      <button type="button" class="btn btn-primary" (click)="acceptRenting(modalData!.event) "[disabled]="modalData?.event?.acceptRenting">Accept Renting</button> 
      <button type="button" class="btn btn-primary" (click)="refuseRenting(modalData!.event) "[disabled]="modalData?.event?.acceptRenting!=null">Refuse Renting</button>

    </ng-container>

  
    <!-- Show other buttons -->
    <ng-container *ngIf="offererOrRequester(modalData!.event) == 0 && !(isCurrentDateSuperior(modalData!.event) && modalData?.event?.fixedRequester && modalData?.event?.fixedOfferer)">
      <button type="button" class="btn btn-primary" [disabled]="!isEditable(modalData!.event)" (click)="saveAndClose(modalData!.event)">Save Changes</button> 
      <button type="button" class="btn btn-primary" [disabled]="!isEditable(modalData!.event)" (click)="fix(modalData!.event)">Fix Time</button>
      <button type="button" class="btn btn-danger" (click)="deleteAndClose(modalData!.event)">Delete</button>
    </ng-container> 
  
    <!-- Show buttons for requester -->
    <ng-container *ngIf="offererOrRequester(modalData!.event) !== 0 && !modalData!.event.fixedRequester ">
      <button type="button" class="btn btn-success" [disabled]="modalData!.event.fixedRequester" (click)="accept(modalData!.event)">Accept</button>
      <button type="button" class="btn btn-danger" [disabled]="modalData!.event.fixedRequester" (click)="refuse(modalData!.event)">Refuse</button>
    </ng-container> 
  </div>
    </ng-template>   

  
  
<app-footer></app-footer>